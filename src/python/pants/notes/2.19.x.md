# 2.19.x Release Series

Pants 2 is a fast, scalable, user-friendly build system for codebases of all sizes. It's currently focused on Python, Go, Java, Scala, Kotlin, Shell, and Docker, with support for other languages and frameworks coming soon.

Individuals and companies can now [sponsor Pants financially](https://www.pantsbuild.org/docs/sponsorship).

Pants is an open-source project that is not owned or controlled by any one company or organization, and does incur some expenses. These expenses are managed by Pants Build, a non-profit that was established for this purpose. This non-profit's only source of revenue is sponsorship by individuals and companies that use Pants.

We offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/docs/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild).

## What's New

### Highlights

### Overall

Tests can now be [attempted multiple times](https://www.pantsbuild.org/v2.19/docs/using-pants-in-ci#tip-automatically-retry-failed-tests), if they fail. This can help with limiting the impact of flaky tests. For instance, to require tests to fail three times before the overall `pants test` goal fails, set [`[test].attempts_default = 3`](https://www.pantsbuild.org/v2.19/docs/reference-test#attempts_default). In this case, a very flaky test might fail on the first and second runs but finally pass on the third run, and thus the overall Pants invocation would pass.

The `.pids/` internal directory is now under `.pants.d/` by default, rather that adjacent to it (this can be controlled via [the `[GLOBAL].pants_subprocessdir` option](https://www.pantsbuild.org/v2.19/docs/reference-global#pants_subprocessdir)).

[The new `[system-binaries]` subsystem](https://www.pantsbuild.org/v2.19/docs/reference-system-binaries) allows controlling where Pants searches for binaries like `bash`, `zip`, `tar` that is uses as part of normal operation. Set [the `system_binaries_paths`](https://www.pantsbuild.org/v2.19/docs/reference-system-binaries#system_binary_paths) as appropriate, potentially using the `<PATH>` special value. This can also be set on specific [environments](https://www.pantsbuild.org/v2.19/docs/environments) using the `system_binaries_system_binary_paths` field.


Additional features and fixes:

- New versions of [the `get-pants.sh` script](https://www.pantsbuild.org/v2.19/docs/installation) install to `~/.local/bin`, not `~/bin`.
- Environment variables that aren't valid UTF-8 no longer cause Pants to crash (note, `PANTS_...` environment variables that Pants needs to read but aren't UTF-8 will be ignored).
- Reference documentation for subsystem options includes how to set them in `pants.toml`, in addition to the environment variable and CLI arguments.
- [Environments](https://www.pantsbuild.org/v2.19/docs/environments) are now more resilient to being (partially) defined via macros, although this is not recommended.
- The `fix` goal now partitions the files across multiple processes more similar to the `lint` goal, which can work around some spurious linting failures.

### BUILD files

[The `parametrize` helper](https://www.pantsbuild.org/v2.19/docs/targets#parametrizing-targets) now supports parametrizing multiple fields together, in lock step. For instance:

``` python
# Creates two targets:
#
#    example:tests@parametrize=py2
#    example:tests@parametrize=py3

python_test(
    name="tests",
    source="tests.py",
    **parametrize("py2", interpreter_constraints=["==2.7.*"], resolve="lock-a"),
    **parametrize("py3", interpreter_constraints=[">=3.6,<3.7"], resolve="lock-b"),
)
```

In addition, `parametrize` can now be used with a single value (`field=parametrize("for-consistency")`), and now works on target generations in more cases (particularly those with "plugin" fields).

### Performance

Some processes are run with more consistent "color" configuration which may result in more cache hits: Pytest, Helm unittest and shunit2 processes now always run with colored output enabled. If [`[GLOBAL].colors`](https://www.pantsbuild.org/v2.19/docs/reference-global#colors) is not enabled, Pants removes the coloring before displaying.

### Remote caching/execution

Large files that need to be stored to a remote cache are now streamed to it directly from disk, in a way that should reduce overhead and increase concurrency ([#19711](https://github.com/pantsbuild/pants/pull/19711)).

### Backends

#### Docker

The [docker backend](https://www.pantsbuild.org/v2.19/docs/docker) now has explicit support for using [`buildx` (and thus BuildKit)](https://github.com/docker/buildx#buildx), via [the new `use_buildx` option](https://www.pantsbuild.org/v2.19/docs/reference-docker#use_buildx). This also allows adding few additional fields for [`docker_image` targets](https://www.pantsbuild.org/v2.19/docs/reference-docker_image), for `buildx`-specific functionality:

- [`cache_from` and `cache_to`](https://www.pantsbuild.org/v2.19/docs/docker#external-cache-storage-backends) for using external cache storage backends
- [`output`](https://www.pantsbuild.org/v2.19/docs/reference-docker_image#codeoutputcode) to control how/where `buildx` outputs an image when running `pants package ::`

#### JVM

JVM lock-files are more reliable, handling [some cases](https://github.com/pantsbuild/pants/issues/20162) of Coursier not including dependencies when expected.

Using [`shading_rules`](https://www.pantsbuild.org/v2.19/docs/reference-deploy_jar#codeshading_rulescode) is now supported on `deploy_jar` targets defined in directories of the build root.

##### Kotlin

The Kotlin analyzer now runs using the Zulu JDK, to be able to run natively on Apple Silicon (arm64 macOS).

##### Java

Dependency inference for Java now supports code using recently added syntax like `sealed class` & `permits`, `switch` expressions and `yield`.

##### Scala

Scala 3 is now supported when using [the BSP in an IDE](https://www.pantsbuild.org/v2.19/docs/jvm-overview#working-in-an-ide).

#### Protobuf

[The `pants.backend.codegen.protobuf.python` backend](https://www.pantsbuild.org/v2.19/docs/protobuf-python) now supports:

- `protobuf_sources` targets that are part of multiple Python resolves, like `python_resolve=parametrize("first-resolve", "second-resolve")`.
- `[python-infer].ambiguity_resolution = "by_source_root"` to infer dependencies without warnings or errors in more cases.

Version 24.4 of [the `protoc` compiler](https://www.pantsbuild.org/v2.19/docs/reference-protoc) is included as a known version (but is not the default). It can be selected by setting `[protoc].version = "24.4"`. This version has native support for Apple Silicon (arm64 macOS).

[Buf (`pants.backend.codegen.protobuf.lint.buf`)](https://www.pantsbuild.org/v2.19/docs/reference-buf) now correctly ignores `buf.work.yaml`, `buf.lock`, `buf.gen.lock` when running as a linter.

#### Python

**Deprecation**: Using the `platforms` field on `pex_binary` is now deprecated. It is not a recommended way to build for platforms other than the local one, as it is a lossy abbreviation of the target platform and often leads to binaries that don't work. To replace this, either [use `complete_platforms` to continue cross-compiling](https://www.pantsbuild.org/v2.19/docs/pex#setting-the-target-platforms-for-a-pex) or use [an environment matching the target platform](https://www.pantsbuild.org/v2.19/docs/environments).

Pants now uses version 2.1.148 of the PEX CLI by default, which includes support for Python 3.12.

Python interpreters provided by ASDF are now searched by default, in addition those provided by pyenv and on the system `PATH`, by being included in the [`[python-bootstrap].search_path`](https://www.pantsbuild.org/v2.19/docs/reference-python-bootstrap#search_path) option.

Many more "groups" of PyPI dependencies have default module mappings that guide how an `import` statement in code matches particular `python_requirement`s. All packages from the `azure-...`, `django-...`, `google-cloud-...`, `opentelemetry-instrumentation-...`, `oslo-...` ecosystems are now matched to modules matching their usual conventions. In addition, packages starting with `python-...` now have that `python-` prefix removed by default: for instance, a package like `python-example-name` will be implicitly assumed to be imported like `import example_name`. [The value of any `module_mapping` field](https://www.pantsbuild.org/v2.19/docs/reference-python_requirements#codemodule_mappingcode) can thus be tweaked (hopefully simplified!).

[The `[generate-lockfiles].diff` option](https://www.pantsbuild.org/v2.19/docs/reference-generate-lockfiles#diff) is now `True` by default, so running `pants generate-lockfiles` now pretty-prints any differences in the dependencies and their versions.

Additional features and fixes:

- [Additional arguments](https://www.pantsbuild.org/v2.19/docs/reference-repl#args) can be passed to the IPython REPL, like `pants repl --shell=ipython :: -- -i helloworld/main.py`.
- Additional arguments can be passed to the underlying PEX invocations when building FaaS artifacts ([AWS Lambda](https://www.pantsbuild.org/v2.19/docs/awslambda-python), [Google Cloud Functions](https://www.pantsbuild.org/v2.19/docs/google-cloud-function-python)) via the new [`pex3_venv_create_extra_args`](https://www.pantsbuild.org/v2.19/docs/reference-python_aws_lambda_function#codepex3_venv_create_extra_argscode) field. For instance, if  dependencies have packaged files in unexpected locations, passing  `pex3_venv_create_extra_args=["--collisions-ok"]` can side-step collision errors.
- The [`pip_version`](https://www.pantsbuild.org/v2.19/docs/reference-python#pip_version) field no longer restricts the values, and so allows more flexibility when upgrading the PEX CLI if it supports newer Pip versions.
- Running tests or `pants run` a source file now make binaries provided by `python_requirement` available for execution as normal processes (for instance, using `subprocess.run(["name-of-binary", ...])`).
- The `PATH` environment variable can now be set using [`[subprocess-environment].env_vars`](https://www.pantsbuild.org/v2.19/docs/reference-subprocess-environment#env_vars)
- Import statements within a `with contextlib.suppress(ImportError)` context are now weak, and so no longer warn if not provided by a dependency.
- Computing an aggregate coverage sandbox report is now more reliable in the presence of name collisions in files created via code-generation (including `relocated_files`).
- Pyright (`pants.backend.experimental.python.typecheck.pyright`) now runs with an appropriately initialised environment and so runs more reliably (especially in transient CI environments, where "named caches" might not be preserved).
- [Ruff (`pants.backend.experimental.python.lint.ruff`)](https://www.pantsbuild.org/v2.19/docs/reference-ruff) now properly respects any `exclude` configuration from `ruff.toml` or `pyproject.toml`.

The following code has been removed, because deprecations have expired:

- Support for building FaaS artifacts ([AWS Lambda](https://www.pantsbuild.org/v2.19/docs/awslambda-python), [Google Cloud Functions](https://www.pantsbuild.org/v2.19/docs/google-cloud-function-python)) via Lambdex has been fully replaced with the new `zip` layout: remove the `[lambdex]` section and its `layout` setting from `pants.toml`.
- Dependency inference now only supports running with the new Rust-based parser. That is, the `[python-infer].use_rust_parser` option cannot be disabled and is now unnecessary.

#### NEW: Semgrep

[The new `pants.backend.experimental.tools.semgrep` backend](https://www.pantsbuild.org/v2.19/docs/reference-semgrep) supports running [Semgrep](https://semgrep.dev) as a local linter on all files that Pants knows about (any target with a `source` or `sources` field). Configuration files are automatically discovered.

#### Terraform

The `check` goal runs `terraform validate` on [`terraform_module`s targets](https://www.pantsbuild.org/v2.19/docs/reference-terraform_module) by default, again. For modules for which this doesn't work and/or isn't desirable, use [the new `skip_terraform_validate` field](https://www.pantsbuild.org/v2.19/docs/reference-terraform_module#codeskip_terraform_validatecode). (This restores the behaviour from Pants 2.17 and earlier, with the addition of the `skip` field, based on feedback about Pants 2.18.0 which switched to only validating `terraform_deployment`s.)

[`terraform_deployment`'s `var_files` field](https://www.pantsbuild.org/v2.19/docs/reference-terraform_deployment#codevar_filescode) now supports files in a different directory to the `root_module`.

## Full Changelog

For the full changelog, see the individual GitHub Releases for this series: https://github.com/pantsbuild/pants/releases

# release_2.19.0.dev4

## New Features

* Add `TransitivelyExcludeDependenciesRequest` to mirror user-provided values ([#20080](https://github.com/pantsbuild/pants/pull/20080))

# release_2.19.0.dev1

## User API Changes

* Enable lockfile diff report by default. ([#19900](https://github.com/pantsbuild/pants/pull/19900))

## Bug Fixes

# release_2.19.0.dev0

## New Features

* Add support for openapi-format ([#18553](https://github.com/pantsbuild/pants/pull/18553))

## User API Changes

* Remove deprecations scheduled for 2.19.0.dev0. ([#19759](https://github.com/pantsbuild/pants/pull/19759))

## Plugin API Changes

* Optionally resolve rules by a provided id ([#19755](https://github.com/pantsbuild/pants/pull/19755))

* Remove TestResult.{stdout,stderr} and all uses. ([#19768](https://github.com/pantsbuild/pants/pull/19768))

## Bug Fixes
