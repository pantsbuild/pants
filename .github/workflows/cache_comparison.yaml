# GENERATED, DO NOT EDIT!
# To change, edit `build-support/bin/generate_github_workflows.py` and run:
#   ./pants run build-support/bin/generate_github_workflows.py


jobs:
  cache_comparison:
    runs-on: ubuntu-latest
    steps:
    - name: Check out code
      uses: actions/checkout@v3
      with:
        fetch-depth: 1024
    - if: github.event_name == 'push'
      name: Get commit message for branch builds
      run: 'echo "COMMIT_MESSAGE<<EOF" >> $GITHUB_ENV

        echo "$(git log --format=%B -n 1 HEAD)" >> $GITHUB_ENV

        echo "EOF" >> $GITHUB_ENV

        '
    - if: github.event_name == 'pull_request'
      name: Get commit message for PR builds
      run: 'echo "COMMIT_MESSAGE<<EOF" >> $GITHUB_ENV

        echo "$(git log --format=%B -n 1 HEAD^2)" >> $GITHUB_ENV

        echo "EOF" >> $GITHUB_ENV

        '
    - if: github.event_name != 'pull_request'
      name: Setup toolchain auth
      run: 'echo TOOLCHAIN_AUTH_TOKEN="${{ secrets.TOOLCHAIN_AUTH_TOKEN }}" >> $GITHUB_ENV

        '
    - env:
        BUILD_DIFFSPEC: ${{ github.event.inputs.buildDiffspec }}
        BUILD_DIFFSPEC_STEP: ${{ github.event.inputs.buildDiffspecStep }}
        PANTS_ARGS: ${{ github.event.inputs.pants_args }}
        SOURCE_DIFFSPEC: ${{ github.event.inputs.sourceDiffspec }}
        SOURCE_DIFFSPEC_STEP: ${{ github.event.inputs.sourceDiffspecStep }}
      name: Cache comparison script
      run: "./pants package build-support/bin/cache_comparison.py\ndist/build-support.bin/cache_comparison_py.pex\
        \ \\\n  --args=\"$PANTS_ARGS\" \\\n  --build-diffspec=\"$BUILD_DIFFSPEC\"\
        \ \\\n  --build-diffspec-step=$BUILD_DIFFSPEC_STEP \\\n  --source-diffspec=\"\
        $SOURCE_DIFFSPEC\" \\\n  --source-diffspec-step=$SOURCE_DIFFSPEC_STEP\n"
    timeout-minutes: 90
name: Cache Comparison
'on':
  workflow_dispatch:
    inputs:
      buildDiffspec:
        required: true
        type: string
      buildDiffspecStep:
        default: 1
        required: false
        type: int
      pants_args:
        default: 'check lint test ::'
        required: false
        type: string
      sourceDiffspec:
        required: true
        type: string
      sourceDiffspecStep:
        default: 1
        required: false
        type: int
