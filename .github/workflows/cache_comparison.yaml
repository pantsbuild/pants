# GENERATED, DO NOT EDIT!
# To change, edit `build-support/bin/generate_github_workflows.py` and run:
#   ./pants run build-support/bin/generate_github_workflows.py


jobs:
  cache_comparison:
    runs-on: ubuntu-latest
    steps:
    - name: Check out code
      uses: actions/checkout@v3
      with:
        fetch-depth: 10
    - if: github.event_name == 'push'
      name: Get commit message for branch builds
      run: 'echo "COMMIT_MESSAGE<<EOF" >> $GITHUB_ENV

        echo "$(git log --format=%B -n 1 HEAD)" >> $GITHUB_ENV

        echo "EOF" >> $GITHUB_ENV

        '
    - if: github.event_name == 'pull_request'
      name: Get commit message for PR builds
      run: 'echo "COMMIT_MESSAGE<<EOF" >> $GITHUB_ENV

        echo "$(git log --format=%B -n 1 HEAD^2)" >> $GITHUB_ENV

        echo "EOF" >> $GITHUB_ENV

        '
    - if: github.event_name != 'pull_request'
      name: Setup toolchain auth
      run: 'echo TOOLCHAIN_AUTH_TOKEN="${{ secrets.TOOLCHAIN_AUTH_TOKEN }}" >> $GITHUB_ENV

        '
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v3
      with:
        python-version: ${{ matrix.python-version }}
    - name: Tell Pants to use Python ${{ matrix.python-version }}
      run: 'echo "PY=python${{ matrix.python-version }}" >> $GITHUB_ENV

        echo "PANTS_PYTHON_INTERPRETER_CONSTRAINTS=[''==${{ matrix.python-version
        }}.*'']" >> $GITHUB_ENV

        '
    - name: Expose Pythons
      uses: pantsbuild/actions/expose-pythons@627a8ce25d972afa03da1641be9261bbbe0e3ffe
    - env:
        BASE_REF: ${{ github.event.inputs.base_ref }}
        BUILD_COMMIT: ${{ github.event.inputs.build_commit }}
        PANTS_ARGS: ${{ github.event.inputs.pants_args }}
        SOURCE_DIFFSPEC: ${{ github.event.inputs.source_diffspec }}
        SOURCE_DIFFSPEC_STEP: ${{ github.event.inputs.source_diffspec_step }}
      name: Prepare cache comparison
      run: 'MODE=debug ./pants package build-support/bin/cache_comparison.py

        git fetch --no-tags --depth=1024 origin "$BASE_REF"

        '
    - env:
        BASE_REF: ${{ github.event.inputs.base_ref }}
        BUILD_COMMIT: ${{ github.event.inputs.build_commit }}
        PANTS_ARGS: ${{ github.event.inputs.pants_args }}
        SOURCE_DIFFSPEC: ${{ github.event.inputs.source_diffspec }}
        SOURCE_DIFFSPEC_STEP: ${{ github.event.inputs.source_diffspec_step }}
      name: Run cache comparison
      run: "dist/build-support.bin/cache_comparison_py.pex \\\n  --args=\"$PANTS_ARGS\"\
        \ \\\n  --build-commit=\"$BUILD_COMMIT\" \\\n  --source-diffspec=\"$SOURCE_DIFFSPEC\"\
        \ \\\n  --source-diffspec-step=$SOURCE_DIFFSPEC_STEP\n"
    strategy:
      matrix:
        python-version:
        - '3.7'
    timeout-minutes: 90
name: Cache Comparison
'on':
  workflow_dispatch:
    inputs:
      base_ref:
        default: main
        required: false
        type: string
      build_commit:
        required: true
        type: string
      pants_args:
        default: 'check lint test ::'
        required: false
        type: string
      source_diffspec:
        required: true
        type: string
      source_diffspec_step:
        default: 1
        required: false
        type: int
