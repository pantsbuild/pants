# GENERATED, DO NOT EDIT!
# To change, edit `src/python/pants_release/generate_github_workflows.py` and run:
#   ./pants run src/python/pants_release/generate_github_workflows.py


concurrency:
  cancel-in-progress: true
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.sha }}
env:
  PANTS_CONFIG_FILES: +['pants.ci.toml']
  RUST_BACKTRACE: all
jobs:
  macos13_x86_64:
    name: MacOS13
    strategy:
      matrix:
        os: [macos-13, macos-14, macOS-10.15-X64, macOS-11-ARM64]
    runs-on:
    - ${{ matrix.os }}
    steps:
    - name: Check out code
      uses: actions/checkout@v4
      with:
        fetch-depth: 10
    - name: Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    - run: |
        python -VV
        file $(which python)

    - run: |
        python -c 'import sysconfig; print(sysconfig.get_platform())'

    - run: |
        _PYTHON_HOST_PLATFORM=x python -c 'import sysconfig; print(sysconfig.get_platform())'

    - run: |
        mkdir -p testing
        cd testing
        python3.11 -m venv .venv
        . .venv/bin/activate
        python -m pip install -U setuptools==74.1.2 wheel==0.44.0
        echo 'from setuptools import setup; setup(name="test", ext_modules=[("native_engine", {"sources": ["test/dummy.c"]})], packages=["test"])' > setup.py
        mkdir -p test
        touch test/dummy.c test/__init__.py
        python setup.py bdist_wheel

        file dist/*
        unzip -l dist/*

    - run: |
        mkdir -p testing2
        cd testing2
        python3.11 -m venv .venv
        . .venv/bin/activate
        python -m pip install -U setuptools==74.1.2 wheel==0.44.0
        echo 'from setuptools import setup; setup(name="test", ext_modules=[("native_engine", {"sources": ["test/dummy.c"]})], packages=["test"])' > setup.py
        mkdir -p test
        touch test/dummy.c test/__init__.py
        python setup.py bdist_wheel

        file dist/*
        unzip -l dist/*
      env:
        _PYTHON_HOST_PLATFORM: macosx-14.0-arm64

name: Pull Request CI
'on':
  pull_request: {}
