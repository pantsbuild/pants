name: "Dump Runner Disk Usage"
description: "Scan the runner's installed software and show sizes."
runs:
  using: composite
  steps:
  - name: Existing free space (all mount points)
    run: "df -h"
    shell: bash
  - name: Existing free space (current directory)
    run: "df -h ."
    shell: bash
  - name: Show sizes of various existing software
    shell: bash
    run: |
      check_path() {
        local title="$1"
        shift

        echo "::group::${title}"
        for path in "$@" ; do
          if [ -d "$path" ]; then
            du -sh "$path"
            du -sh "${path}/*"
          else
            echo "WARNING: Path '${path}' does not exist or is not a directory."
          fi
        done
        echo "::endgroup::"
      }

      check_path DotNet /usr/share/dotnet
      check_path Android /usr/local/lib/android
      check_path Haskell /opt/ghc /usr/local/.ghcup
      check_path CodeQL /opt/hostedtoolcache/CodeQL