# 2.21.x Release Series

Pants 2 is a fast, scalable, user-friendly build system for codebases of all sizes. It's currently focused on Python, Go, Java, Scala, Kotlin, Shell, and Docker, with support for other languages and frameworks coming soon.

Individuals and companies can now [sponsor Pants financially](https://www.pantsbuild.org/sponsorship).

Pants is an open-source project that is not owned or controlled by any one company or organization, and does incur some expenses. These expenses are managed by Pants Build, a non-profit that was established for this purpose. This non-profit's only source of revenue is sponsorship by individuals and companies that use Pants.

We offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild).

## What's New

### Highlights

- Automatic retries of tests for all built-in backends.

Keep reading to see the details and what's also included.

### Overall

All built-in targets that support testing with the `pants test` goal now support automatic retries, using [the `[test].attempts_default` option](https://www.pantsbuild.org/2.21/reference/goals/test#attempts_default).

When running in CI, the printed summary at the end of a `pants test ...` run will now include single invocation to rerun all failing tests, if any. This can be controlled by [the new `[test].show_rerun_command` option](https://www.pantsbuild.org/2.21/reference/goals/test#show_rerun_command).

Option values can now be optionally [read from files using `@?...`](https://www.pantsbuild.org/2.21/docs/using-pants/key-concepts/options#reading-individual-option-values-from-files). For instance, `opt = "@some_file.txt"` will give an error if `some_file.txt` does not exist, but the new syntax `opt = "@?some_file.txt"` will just leave the option unset.

The `stats` subsystem can now output structured data, using [the new `[stats].format = "jsonlines"` option](https://www.pantsbuild.org/2.21/reference/subsystems/stats#format). This is designed to make ingesting and analysis this information easier, such as tracking information about CI builds.

Introspection goals have had a few improvements:

* [`pants peek ...`](https://www.pantsbuild.org/2.21/docs/using-pants/project-introspection#peek---programmatically-inspect-a-target) now includes a `goals` field for some targets

* Using the `json` format for [`pants dependencies ...`](https://www.pantsbuild.org/2.21/reference/goals/dependencies#format) or [`pants dependencies ...`](format#format) now correctly obeys the `output_file` setting.

### BUILD files


### Remote caching/execution


### Backends

#### Adhoc


#### Docker

The [`cache_from` field](https://www.pantsbuild.org/2.21/reference/targets/docker_image#cache_from) on `docker_image` now supports multiple values.

The [new `extra_run_args` field](https://www.pantsbuild.org/2.21/reference/targets/docker_image#extra_run_args) on `docker_image` allows adding extra arguments that are passed into the `docker run ...` invocation when running the image with `pants run`.

Pants now correctly extracts the image ID when using `docker buildx` version 0.13.1 or greater.

#### Go

Failing `go_packagee` tests can now be automatically retried by setting [the `[test].attempts_default` option](https://www.pantsbuild.org/2.21/docs/go#retries).

#### Helm

Failing `helm_unittest_test` tests can now be automatically retried by setting [the `[test].attempts_default` option](https://www.pantsbuild.org/2.21/docs/helm#retries).

[The `sources` field](https://www.pantsbuild.org/2.21/reference/targets/helm_chart#sources) of `helm_chart` targets now includes documentation files like `README.md` and  `values.schema.json` so that they are available once published.

Versions 3.13.3 and 3.14.3 of the Helm tool are know [known](https://www.pantsbuild.org/2.21/reference/subsystems/helm#known_versions). Version 3.14.3 is now [the default version](https://www.pantsbuild.org/2.21/reference/subsystems/helm#version).

The `experimental-deploy` goal now has built-in support for [the `--dry-run` option](https://www.pantsbuild.org/2.21/reference/goals/experimental-deploy#dry_run), which passes that to the underlying Helm invocation.

#### JavaScript

Failing `javascript_test` tests can now be automatically retried by setting [the `[test].attempts_default` option](https://www.pantsbuild.org/2.21/reference/goals/test#attempts_default).

`package_json` targets using yarn v2 or greater as the package manager are now supported.

#### JVM

Failing `kotlin_junit_test`, `junit_test`, and `scala_junit_test` tests can now be automatically retried by setting [the `[test].attempts_default` option](https://www.pantsbuild.org/2.21/docs/jvm/java-and-scala#retries).

##### Scala

The Scalafix can now be run by Pants using the [new `pants.backend.experimental.scala.lint.scalafix` backend](https://www.pantsbuild.org/2.21/docs/jvm/java-and-scala#fix-scala-code).

#### Python


#### Shell

[The `pants.backend.shell.lint.shellcheck` backend](https://www.pantsbuild.org/2.21/reference/subsystems/shellcheck) now uses [version 0.10.0 by default](https://www.pantsbuild.org/2.21/reference/subsystems/shellcheck#version).

Failing `shunit2_test` and `experimental_test_shell_command` tests can now be automatically retried by setting [the `[test].attempts_default` option](https://www.pantsbuild.org/2.21/docs/shell#retries).

#### Terraform

The `experimental-deploy` goal now has built-in support for [the `--dry-run` option](https://www.pantsbuild.org/2.21/reference/goals/experimental-deploy#dry_run), which runs `terraform plan` instead of `terraform apply`.

#### TypeScript


### Plugin API changes


## Full Changelog

For the full changelog, see the individual GitHub Releases for this series: https://github.com/pantsbuild/pants/releases

# unreleased

* Fix: Example config for local filesystem caching (Cherry-pick of #20844) (#20849)

* docs: Remove note about abbreviated form (Cherry-pick of #20830) (#20834)

# release_2.21.0a0

## New Features

* Add additional modules to default module mapping ([#20813](https://github.com/pantsbuild/pants/pull/20813))

* add some module mappings ([#20800](https://github.com/pantsbuild/pants/pull/20800))

* Improve exported mutable_virtualenv prompt ([#20796](https://github.com/pantsbuild/pants/pull/20796))

* Add export option: py_hermetic_scripts ([#20763](https://github.com/pantsbuild/pants/pull/20763))

* Visibility: support `dict` rules same way as for selectors. ([#20769](https://github.com/pantsbuild/pants/pull/20769))

* Add python312 runtime to python_google_cloud_function ([#20786](https://github.com/pantsbuild/pants/pull/20786))

## User API Changes

* Replaced pre-commit githook with pre-push ([#20784](https://github.com/pantsbuild/pants/pull/20784))

## Bug Fixes

* Fixed install_git_hooks.sh does not work if "python" is not found (but python3 exists) ([#20783](https://github.com/pantsbuild/pants/pull/20783))

* re-add missing opentelemetry.util module mapping ([#20804](https://github.com/pantsbuild/pants/pull/20804))

* Fix direct_url in python PEP660 editable wheels (again) ([#20798](https://github.com/pantsbuild/pants/pull/20798))

* provide a more friendly pointer on unconfigured constraint file ([#20781](https://github.com/pantsbuild/pants/pull/20781))

* update Pex to 2.3.1 ([#20782](https://github.com/pantsbuild/pants/pull/20782))

* Fix issue with explicit dependency when using parametrize groups. ([#20768](https://github.com/pantsbuild/pants/pull/20768))

## Performance

* Set --no-pre-install-wheels and PEX_MAX_INSTALL_JOBS for faster builds of internal pexes ([#20670](https://github.com/pantsbuild/pants/pull/20670))

## Documentation

* fix Python & NodeJS lockfiles doc ([#20812](https://github.com/pantsbuild/pants/pull/20812))

* improve plants plugin resolve docs ([#20780](https://github.com/pantsbuild/pants/pull/20780))

# release_2.21.0.dev6

## New Features

* Make tools exportable ([#20730](https://github.com/pantsbuild/pants/pull/20730))

* Allow plugin authors to attach custom fields to TargetData for pants peek ([#20701](https://github.com/pantsbuild/pants/pull/20701))

## User API Changes

* Remove the deprecated implicit_value option kwarg. ([#20762](https://github.com/pantsbuild/pants/pull/20762))

# release_2.21.0.dev5

NB. this release is broken on arm64 macOS, see https://github.com/pantsbuild/pants/issues/20765.

## New Features

* Allow passing arguments to PEX invocation used for `pex_binary` ([#20737](https://github.com/pantsbuild/pants/pull/20737))

## Bug Fixes

* upgrade Pex to 2.3.0 ([#20734](https://github.com/pantsbuild/pants/pull/20734))

## Performance

* Make all "local dists" PEXes internal-only ([#20746](https://github.com/pantsbuild/pants/pull/20746))

# release_2.21.0.dev4

## Bug Fixes

* Core: Fix `__defaults__` to also apply for generated file targets. ([#20649](https://github.com/pantsbuild/pants/pull/20649))

## Documentation

* docs: update docs for debian_package target ([#20665](https://github.com/pantsbuild/pants/pull/20665))

# release_2.21.0.dev3

## New Features

## Bug Fixes

* Support Go versioning with patch ([#20677](https://github.com/pantsbuild/pants/pull/20677))

## Documentation

* fix doc link ([#20680](https://github.com/pantsbuild/pants/pull/20680))

* Add Pyright, Pytype and Ruff to Python overview docs ([#20663](https://github.com/pantsbuild/pants/pull/20663))

# release_2.21.0.dev2

## User API Changes

* Upgrade Ruff to v0.3.0 ([#20647](https://github.com/pantsbuild/pants/pull/20647))

# release_2.21.0.dev0

## User API Changes

* Remove now-expired deprecated `python_awslambda` alias ([#20619](https://github.com/pantsbuild/pants/pull/20619))

---

(NB. this release had its tag moved to a different commit and then back on 2024-03-04. The built artifacts are from the first time it was pointing at this commit, not the current tag. [ref](https://chat.pantsbuild.org/t/16640400/oops-i-think-i-just-re-tagged-2-21-0-dev0-incorrectly-and-th#12ed63f0-4e77-4c75-b7bc-92ec99fdbfd9).)

# release_2.21.0.dev1

* use explicit Pex options for package "binary-ness" (#20598)

* docs: Fix GitHub brand notation (#20629)

* Split skip ruff field into two (#20626)

* Regenerate all Python tool lock-files (updating many) and update to pip_version = 24.0, for Py 3.12 support (#20365)

* Fix use of deprecated fields on target generators. (#20628)
