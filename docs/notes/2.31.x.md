# 2.31.x Release Series

Pants is a fast, scalable, user-friendly build system for codebases of all sizes.

Pants is an open-source project that is not owned or controlled by any one company or organization, and does incur some expenses. These expenses are managed by Pants Build, a non-profit that was established for this purpose. This non-profit's only source of revenue is [sponsorship](https://www.pantsbuild.org/sponsorship) by individuals and companies that use Pants.

We offer [formal sponsorship tiers for companies](https://www.pantsbuild.org/sponsorship), as well as individual sponsorships via [GitHub](https://github.com/sponsors/pantsbuild).

Thank you to [Klaviyo](https://www.klaviyo.com/) for their Platinum tier support through throughout this release.

## What's New

### Highlights

### Deprecations

### Removals

Removed `fix_deprecated_globs_usage.py` which was used for migration during the deprecation period of `globs()`, `rglobs()`, and `zglobs()` in [Pants 1.26](https://github.com/pantsbuild/pants/pull/9040). This functionality, including the associated deprecation message, was removed in [Pants 1.27](https://github.com/pantsbuild/pants/pull/9247). The deprecation message pointed (through a URL shortener) to this file located on `master`. If you still require access to `fix_deprecated_globs_usage.py` - you can download it from [the 2.29 tagged release](https://raw.githubusercontent.com/pantsbuild/pants/refs/tags/release_2.29.0/build-support/migration-support/fix_deprecated_globs_usage.py).

Following the annoucement in in the [2.30.x](https://github.com/pantsbuild/pants/blob/2.30.x/docs/notes/2.30.x.md) release, Pants 2.31.x no longer provides binaries for `x86_64` macOS.  This flows from the [reduced support](https://github.com/actions/runner-images/issues/13046) from GitHub and continued movement in the macOS ecosystem.  If you are interested in maintaining or resurrecting supporting `x86_64` macOS binaries, please [reach out](https://github.com/pantsbuild/pants/discussions/22711).


### General

pantsd now preserves web proxy environment variables (`HTTP_PROXY`, `HTTPS_PROXY`, `NO_PROXY`), allowing it to function in environments with restricted internet access.

EXPERIMENTAL: Pants is run by way of the [scie-pants launcher binary](https://www.pantsbuild.org/blog/2023/02/23/the-pants-launcher-binary-a-much-simpler-way-to-install-and-run-pants).  When you run "`pants`" this launcher combines [Python Build Standalone](https://gregoryszorc.com/docs/python-build-standalone/main/) with a PEX of Pants from a `pantsbuild/pants` GitHub release.  The logic for which version of Python to use (and which PBS "release version") is part of the launcher.  Pants 2.31 release includes experimental support for fully executable SCIEs that already have PBS+Pants combined as a SCIE.  Under the GitHub release next to  `pants.2.31.0-cp311-linux_x86_64.pex` (a PEX in requiring a Python interpreter) you will also see `pants.2.31.0-cp311-linux_x86_64` (a self-contained Linux binary). These are intended for testing only. The recommended way to use Pants is still the [existing launcher binary](https://www.pantsbuild.org/stable/docs/getting-started/installing-pants).

This work stands on the shoulders of support from the [Science Projects](https://github.com/a-scie) and Pex](https://github.com/pex-tool/pex).

### Goals

### Backends

#### Helm

#### JVM

A [bug](https://github.com/pantsbuild/pants/pull/23036) was fixed where the JDK preparation script's non-deterministic behaviorâ€”caused by unsuppressed Coursier progress outputâ€”led to unnecessary cache misses.

Java first party dependency inference logic [now](https://github.com/pantsbuild/pants/pull/22889) correctly identifies unqualified, same-package inner class references.

Updated to use Coursier v2.1.24 by default to pick up a bug fix allowing us to [simplify our code a bit](https://github.com/pantsbuild/pants/pull/22906).

#### Python

A variety of Pex options to support building [native executables
"scies"](https://github.com/a-scie/) are now plumbled through.  While a
traditional PEX is a "Python Executable" that can be run by a Python
interpreter, a scie PEX takes that a step forward by including its own Python.
This is similar to the way the [launcher
binary](https://www.pantsbuild.org/blog/2023/02/23/the-pants-launcher-binary-a-much-simpler-way-to-install-and-run-pants)
used by Pants itself works.

Added the `[python].default_to_resolve_interpreter_constraints` option which when set the true, allows Python targets with both `interpreter_constraints` and `resolve` fields to fallback on their resolve's interpreter constraints before the global constraints if no interpreter constraints are set on the actual target.

The version of [Pex](https://github.com/pex-tool/pex) used by the Python backend has been upgraded to [`v2.81.0`](https://github.com/pex-tool/pex/releases/tag/v2.81.0). Of particular note for Pants users:
- A [bug](https://github.com/pantsbuild/pants/issues/22886) that hindered the use of multiple custom package indexes
- A [bug](https://github.com/pex-tool/pex/issues/3032) that prevented invalidation of a lockfile when the URL of a URL-based requirement changed.
- An issue with [`PEX_PYTHON/PEX_PYTHON_PATH` stripping](https://github.com/pex-tool/pex/issues/1075).
- Improved `__init__.py` collision detection by way of [inspects the AST](https://github.com/pex-tool/pex/releases/tag/v2.77.2).

The Python Build Standalone backend (`pants.backend.python.providers.experimental.python_build_standalone`) has release metadata current through PBS release `20251217`

The default interpreter constraints for tools have been standardized to require Python from 3.9 to 3.14. The default lockfiles have been generated to match. No top-level subsystem tools were updated, but several tool dependencies were. The most notable being `protobuf` updated from 6.33.0 to [6.33.1](https://pypi.org/project/protobuf/6.33.1/).

Pyright support has been improved so that a large number of input files no longer causes an error.

Added `[pytest].allow_empty_test_collection` option to treat pytest exit code 5 ("No tests were collected") as success. When enabled, test runs where all tests are deselected (e.g. filtering or markers) will be treated as having no tests and skipped in the summary instead of failing.

Added `[python].resolves_to_complete_platforms` option to specify complete platform JSON files (via `file` or `resource` targets) for generating platform-specific lockfiles. This allows precise control over which platforms are included when generating locks, useful for cross-platform builds and deployment scenarios.

Added `[python].resolves_to_lock_style` option to configure the lock style (`strict`, `sources`, or `universal`) per resolve. The `strict` style includes only the artifact that would be used (either a wheel or an sdist, but not both), `sources` includes both wheels and sdists when available, and `universal` generates locks that work across multiple platforms.

The `pip` download log from `pex` is now materialized into the sandbox when resolving plugins with a file named `pex-pip-download.log`.

Added a default module mapping for `apache-airflow-client`, which provides the `airflow_client` module

#### Protobuf

Upgraded the default version of `protoc` to v30.2. Python projects should upgrade the `protobuf` Python requirement to a v6.x version. Java projects should upgrade the `protobuf-java` artifact to a 4.x version.

#### Shell

`shell_command` targets are now runnable via the `run` goal and can be used as a "runnable" target by other targets including the `code_quality_tool` target type. The `run_shell_command` target type remains available at the moment. The difference between running a `shell_command` versus a `run_shell_command` target is that `shell_command` targets can be run within the Pants execution sandbox (and outputs captured) while the more limited execution model of the `run_shell_command` target type only supports interactive execution.

#### Javascript

#### TypeScript

#### Go

Go now compiles with trimpath to strip sandbox paths from output, allowing for reproducible builds.

The golangci-lint backend now supports multi-module Go repositories by partitioning lint runs per `go_mod` target, running golangci-lint from each module's directory. This release also upgrades golangci-lint to v2.

#### NEW: nFPM Native Libs

Added a new experimental `pants.backend.experimental.nfpm.native_libs` backend to complement the [`nFPM`](https://nfpm.goreleaser.com/) backend (originally added in [pants 2.23](https://github.com/pantsbuild/pants/blob/main/docs/notes/2.23.x.md#new-nfpm)). `nFPM` builds system packages, but, unlike native packaging tools, does not inspect packaged binaries to automatically record package `depends` (aka `requires`). The nFPM Native Libs backend is meant to fill that feature gap, simplifying package dependency management.

Initially, this backend only supports:
- `rpm` packages (by inspecting the dependencies of `nfpm_rpm_package` targets;
- native libraries packaged as wheels in `pex_binary` targets;
- native libraries and binaries in the [`ELF`](https://en.wikipedia.org/wiki/Executable_and_Linkable_Format) format (used on linux);

So, this backend provides a simplified set of features from these native packaging tools:
- `rpm`: `elfdeps` analyzes ELF metadata and `rpmdeps` adds the requirements to the `.rpm` file.

This backend should be platform-agnostic, allowing it to run wherever `pants` can run. To do this, it relies on the [`elfdeps`](https://github.com/python-wheel-build/elfdeps) [ðŸ“¦](https://pypi.org/project/elfdeps/) pure-python package (a "Python implementation of RPM `elfdeps`" with its pure-python dep [`pyelftools`](https://github.com/eliben/pyelftools) [ðŸ“¦](https://pypi.org/project/pyelftools/)) for analyzing `ELF` libraries.

Please provide feedback on this backend [here](https://github.com/pantsbuild/pants/discussions/22396).

### Plugin API changes

Pants no longer supports loading `pkg_resources`-style namespace packages for plugins. Instead, just use ["native namespace packages"](https://packaging.python.org/en/latest/guides/packaging-namespace-packages/#native-namespace-packages) as per [PEP 420](https://peps.python.org/pep-0420/).

Allow `InteractiveProcess` to set the working directory relative to the sandbox or workspace. Existing usages of `InteractiveProcess.from_process` will now respect the working directory if its set on the Process, which may be a breaking change depending on the use case. Two existing rules `twine_upload` for python package uploads and `test_shell_command_interactively` for shell command testing with the `--debug` flag will now honor the working directory if set on the Process.

Pex is no longer included *as a Python module* in the default lockfile.  Pex is still used as a cli tool as intended.

#### nFPM backend

Added a new rule to help in-repo plugins implement the `inject_nfpm_package_fields(InjectNfpmPackageFieldsRequest) -> InjectedNfpmPackageFields` polymorphic rule. The `get_package_field_sets_for_nfpm_content_file_deps` rule (in the `pants.backend.nfpm.util_rules.contents` module) collects selected `PackageFieldSet`s from the contents of an `nfpm_*_package` so that the packages can be analyzed to inject things like package requirements.

Added prioritized rule chaining for `InjectNfpmPackageFieldsRequest` polymorphic rule implementations. Before, only one request type was allowed to inject fields on each `nfpm_*_package` target. Now, the `InjectNfpmPackageFieldsRequest` subclasses can declare a priority (as `ClassVar[int]`) so that the rule runs after lower-priority requests and before higher-priority requests. By default, `InjectNfpmPackageFieldsRequest` implementations are priority 10, and any subclasses have that priority increased by 1 so that the subclass is higher priority than its parent class. Any implementations distributed with pants should have a lower priority (`< 10`) so that in-repo and external plugins can override the pants-provided defaults.

## Full Changelog

For the full changelog, see the individual GitHub Releases for this series: <https://github.com/pantsbuild/pants/releases>
