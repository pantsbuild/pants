# All of the following are seeded with defaults in the config
#   user: the current user
#   homedir: the current user's home directory
#   buildroot: the root of this repo
#   pants_bootstrapdir: the global pants scratch space primarily used for caches
#   pants_configdir: the global pants storage for config files
#   pants_supportdir: pants support files for this repo go here; for example: ivysettings.xml
#   pants_distdir: user visible artifacts for this repo go here
#   pants_workdir: the scratch space used to for live builds in this repo

[DEFAULT]
print_exception_stacktrace: True

# Enable our own custom loose-source plugins as well as contribs.
pythonpath: [
    "%(buildroot)s/pants-plugins/src/python",
    "%(buildroot)s/contrib/scrooge/src/python",
    "%(buildroot)s/contrib/spindle/src/python",
    "%(buildroot)s/contrib/cpp/src/python",
  ]

outdir: %(pants_distdir)s

jvm_options: ["-Xmx1g", "-XX:MaxPermSize=256m"]

[goals]
bootstrap_buildfiles: [
    "%(buildroot)s/BUILD",
    "%(buildroot)s/contrib/BUILD"
  ]

[ivy]
# We need a custom ivy profile to grab the optional pgp libs for
# signing artifacts we publish to maven central.
ivy_profile: %(pants_supportdir)s/ivy/ivy.xml


[gen.scrooge]
strict: False
verbose: True
service_deps: {
    "java": [
            "3rdparty:commons-lang",
            "3rdparty:finagle-thrift",
            "3rdparty:slf4j-api",
            "3rdparty:util-core"
            ],
    "scala": [
             "3rdparty:finagle-thrift",
             "3rdparty:scrooge-core",
             "3rdparty:util-core"
             ],
  }
structs_deps: {
    "java": [
            "3rdparty:commons-lang",
            "3rdparty:thrift"
            ],
    "scala": [
             "3rdparty:scrooge-core",
             "3rdparty:thrift"
             ],
  }


[gen.thrift]
strict: False
java: {
    "gen": "java:hashcode",
    "deps": {
      "service": ["3rdparty:thrift-0.5.0-finagle"],
      "structs": ["3rdparty:thrift-0.5.0"]
    }
  }
python: {
    "gen": "py:new_style",
    "deps": {
      "service": ["3rdparty/python:thrift"],
      "structs": ["3rdparty/python:thrift"]
    }
  }


[compile.checkstyle]
bootstrap_tools: ["//:checkstyle"]
configuration: %(pants_supportdir)s/checkstyle/coding_style.xml


[compile.scalastyle]
config: %(buildroot)s/build-support/scalastyle/scalastyle_config.xml
excludes: %(buildroot)s/build-support/scalastyle/excludes.txt


[repl.scala]
scala_repl: ["//:scala-repl"]
jvm_options: ["-Xmx1g", "-XX:MaxPermSize=256m", "-Dscala.usejavacp=true" ]


[compile.java]
partition_size_hint: 1000000000
jvm_options: ["-Xmx2G"]

source: 6
target: 6

compiler-bootstrap-tools: ["//:java-compiler"]


[compile.scala]
runtime-deps: ["//:scala-library"]
jvm_options: ["-Xmx2g", "-XX:MaxPermSize=256m", "-Dzinc.analysis.cache.limit=0"]


[run.jvm]
jvm_options: ["-Xmx1g", "-XX:MaxPermSize=256m"]

[resources.prepare]
resources_dir_patterns_for_jarring: ['ab', 'cd', 'ef']
short_resources_jar_path: False

[test.junit]
# -XX:-UseSplitVerifier is needed for emma instrumenter to work against classfiles generated by
# java 7 compilers
jvm_options: [
    "-Djava.awt.headless=true", "-Xmx1g", "-XX:MaxPermSize=256m",
    "-XX:-UseSplitVerifier"
  ]


[run.specs]
jvm_options: ["-Xmx1g", "-XX:MaxPermSize=256m"]


[bench]
jvm_options: ["-Xmx1g", "-XX:MaxPermSize=256m"]


[idea]
python_source_paths: ["src/python"]
python_test_paths: ["tests/python"]
python_lib_paths: ["3rdparty/python"]
scala_maximum_heap_size_mb: 1024
java_maximum_heap_size_mb: 1024


[publish]
ivy_settings: %(pants_supportdir)s/ivy/publish.ivysettings.xml
push_postscript:
  # Prevent Travis-CI from running for this automated jar publish commit:
  #   http://docs.travis-ci.com/user/how-to-skip-a-build/
  [ci skip]
repos: {
    'public': {  # must match the name of the `Repository` object that you defined in your plugin.
      'resolver': 'oss.sonatype.org', # must match hostname in ~/.netrc and the <url> parameter
                                      # in your custom ivysettings.xml.
      # NB: default, sources, and javadoc are added automatically - they are listed here for sanity
      # sake but only 'changelog' is needed.  Fixing confs configuration to be needed or trimmed is
      # tracked here: https://github.com/pantsbuild/pants/issues/1410
      'confs': ['default', 'sources', 'javadoc', 'changelog'],
      'auth': 'build-support/ivy:netrc',  # Pants spec to a 'credentials()' object.
      'help': 'Configure your ~/.netrc for oss.sonatype.org access.'
    }
  }
restrict_push_branches: ['master']


[python-setup]
# We only support pants running under 2.7 for now with 3.3+ support to be added later.
# Any example or test targets that are meant to test interpreters outside pants own
# acceptable set should specify an explicit compatibility constraint.
interpreter_requirement: CPython>=2.7,<3


[python-repos]
repos: [
    "https://pantsbuild.github.io/cheeseshop/third_party/python/dist/index.html",
    "https://pantsbuild.github.io/cheeseshop/third_party/python/index.html"
  ]

indexes: ["https://pypi.python.org/simple/"]


[backends]
packages: [
    "internal_backend.optional",
    "internal_backend.repositories",
    "internal_backend.sitegen",
    "internal_backend.utilities",
    "pants.contrib.cpp",
    "pants.contrib.scrooge",
    "pants.contrib.spindle",
  ]


[sign]
# Default to debug keystore installed with SDK.
# You can change this to point to a config.ini holding the definition of your keys.
keystore_config_location: %(pants_configdir)s/android/keystore/default_config.ini
